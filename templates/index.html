<!DOCTYPE html>
<html lang="zh-CN"> 
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>超市折扣搜索引擎</title>
    <style>
        /* CSS样式部分保持不变，让页面更美观 */
        body { font-family: sans-serif; background-color: #f4f4f9; color: #333; margin: 0; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #0056b3; text-align: center; }
        .search-box { display: flex; gap: 10px; margin-bottom: 20px; }
        #searchInput { flex-grow: 1; padding: 10px; font-size: 16px; border: 1px solid #ccc; border-radius: 4px; }
        #searchButton { padding: 10px 20px; font-size: 16px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        #searchButton:hover { background-color: #0056b3; }
        #resultsContainer { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; }
        .product-card { border: 1px solid #ddd; border-radius: 8px; padding: 15px; background-color: #fff; box-shadow: 0 1px 3px rgba(0,0,0,0.05); text-align: center; display: flex; flex-direction: column; justify-content: space-between;}
        .product-card img { max-width: 100%; height: 150px; object-fit: contain; margin-bottom: 10px; }
        .product-card h3 { font-size: 1em; margin: 10px 0; flex-grow: 1;}
        .product-card p { font-size: 0.9em; color: #666; }
        .loading-spinner { border: 5px solid #f3f3f3; border-top: 5px solid #3498db; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="container">
        <h1>超市折扣搜索引擎</h1>
        <div class="search-box">
            <input type="text" id="searchInput" placeholder="输入商品名，如 mjölk, ost, ägg...">
            <button id="searchButton">搜索</button>
        </div>
        <hr>
        <div id="resultsContainer"></div>
    </div>

    <script>
        const searchButton = document.getElementById("searchButton");
        const searchInput = document.getElementById("searchInput");
        const resultsContainer = document.getElementById("resultsContainer");

        // ==============================================================================
        // "铸造厂" - 采纳了你的所有建议
        // ==============================================================================
        function createProductCard(product) {
            const card = document.createElement("div");
            card.className = "product-card";

            const img = document.createElement("img");
            img.src = product.image;
            img.alt = product.name;

            const title = document.createElement("h3");
            title.textContent = product.name;

            const info = document.createElement("p");
            
            // --- 1. 新的价格显示逻辑 ---
            const priceType = product.price_type;
            const priceValue = product.price_value;
            let priceText;

            // 使用 switch 语句，可读性更好
            switch (priceType) {
                case "membershipPrice":
                    priceText = `会员价: ${priceValue} kr`;
                    break;
                case "appPrice":
                    priceText = `App专享价: ${priceValue} kr`;
                    break;
                case "fromPrice":
                    priceText = `${priceValue} kr 起`;
                    break;
                case "price":
                    priceText = `${priceValue} kr`;
                    break;
                default: // 'none'
                    priceText = "价格未提供";
            }
            
            // --- 2. 组合最终显示的文本 ---
            info.textContent = `超市: ${product.supermarket} | ${priceText}`;

            card.appendChild(img);
            card.appendChild(title);
            card.appendChild(info);
            
            return card;
        }

        function renderProducts(productList) {
            resultsContainer.innerHTML = "";
            if (!productList || productList.length === 0) {
                resultsContainer.textContent = "没有找到相关的打折商品。";
                return;
            }
            for (const product of productList) {
                const card = createProductCard(product);
                resultsContainer.appendChild(card);
            }
        }
        
        function handleSearchClick() {
            const keyword = searchInput.value.trim();
            if (!keyword) {
                alert("请输入要搜索的商品！");
                return;
            }
            resultsContainer.innerHTML = '<div class="loading-spinner"></div>';
            const apiUrl = `/search?keyword=${keyword}`;

            fetch(apiUrl)
                .then(response => {
                    if (!response.ok) throw new Error(`网络响应错误: ${response.status}`);
                    return response.json();
                })
                .then(data => {
                    renderProducts(data);
})
                .catch(error => {
                    console.error("获取数据时发生错误:", error);
                    resultsContainer.textContent = "加载失败，请检查网络或稍后再试。";
                });
        }

        searchButton.addEventListener("click", handleSearchClick);
        searchInput.addEventListener("keyup", event => {
            if (event.key === "Enter") handleSearchClick();
        });
    </script>
</body>
</html>